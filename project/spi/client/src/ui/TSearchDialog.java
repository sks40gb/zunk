/*
 * TSearchDialog.java
 *
 * Created on March 21, 2008, 2:45 PM
 */
package ui;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;

/**
 * Dialog Window to Search text in Selected Export Files
 * 
 * @author  anurag
 */

public class TSearchDialog extends javax.swing.JDialog
{

   private String fileName = null;
   private String word = null;
   private String line = null;
   private StringBuffer fileContent = null;
   private String currentDir = null;
   private JDialog parent;

   /** Creates new form TSearchDialog */
   public TSearchDialog(JDialog parent, String folderPath)
   {
      super(parent);
      this.parent = parent;
      currentDir = folderPath;
      initComponents();
   }

   /** This method is called from within the constructor to
    * initialize the form.
    * WARNING: Do NOT modify this code. The content of this method is
    * always regenerated by the Form Editor.
    */
   // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
   private void initComponents() {

      jPanel1 = new javax.swing.JPanel();
      jLabel2 = new javax.swing.JLabel();
      t_fileName = new javax.swing.JTextField();
      processButton = new javax.swing.JButton();
      jLabel3 = new javax.swing.JLabel();
      t_textSearch = new javax.swing.JTextField();
      browseButton = new javax.swing.JButton();
      exitbutton = new javax.swing.JButton();
      jLabel4 = new javax.swing.JLabel();
      cb_searchOptions = new javax.swing.JComboBox();
      jLabel1 = new javax.swing.JLabel();

      setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
      setTitle("Utility Program (TSEARCH.EXE)");

      jPanel1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(153, 153, 0)));

      jLabel2.setFont(new java.awt.Font("Dialog", 1, 12));
      jLabel2.setForeground(new java.awt.Color(0, 0, 153));
      jLabel2.setText("File Name :");

      t_fileName.setColumns(40);
      t_fileName.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            t_fileNameActionPerformed(evt);
         }
      });

      processButton.setFont(new java.awt.Font("Dialog", 1, 12));
      processButton.setForeground(new java.awt.Color(0, 51, 153));
      processButton.setText("PROCESS");
      processButton.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            processButtonActionPerformed(evt);
         }
      });

      jLabel3.setFont(new java.awt.Font("Dialog", 1, 12));
      jLabel3.setForeground(new java.awt.Color(0, 0, 153));
      jLabel3.setText("Text to Search :");

      t_textSearch.setColumns(40);
      t_textSearch.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            t_textSearchActionPerformed(evt);
         }
      });

      browseButton.setText(".....");
      browseButton.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            browseButtonActionPerformed(evt);
         }
      });

      exitbutton.setFont(new java.awt.Font("Dialog", 1, 12));
      exitbutton.setForeground(new java.awt.Color(0, 51, 153));
      exitbutton.setText("CLOSE");
      exitbutton.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            exitbuttonActionPerformed(evt);
         }
      });

      jLabel4.setFont(new java.awt.Font("Dialog", 1, 12));
      jLabel4.setForeground(new java.awt.Color(0, 0, 153));
      jLabel4.setText("Search Options :");

      cb_searchOptions.setFont(new java.awt.Font("Dialog", 0, 12));
      cb_searchOptions.setForeground(new java.awt.Color(0, 0, 153));
      cb_searchOptions.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Number of Occurences of Data", "Location of text / data" }));

      javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
      jPanel1.setLayout(jPanel1Layout);
      jPanel1Layout.setHorizontalGroup(
         jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel1Layout.createSequentialGroup()
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(jPanel1Layout.createSequentialGroup()
                  .addContainerGap()
                  .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                     .addComponent(jLabel3)
                     .addComponent(jLabel2)
                     .addComponent(jLabel4))
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                     .addComponent(cb_searchOptions, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .addComponent(t_fileName)
                     .addComponent(t_textSearch))
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                  .addComponent(browseButton, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE))
               .addGroup(jPanel1Layout.createSequentialGroup()
                  .addGap(121, 121, 121)
                  .addComponent(processButton)
                  .addGap(72, 72, 72)
                  .addComponent(exitbutton)))
            .addContainerGap())
      );
      jPanel1Layout.setVerticalGroup(
         jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel1Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(jLabel2)
               .addComponent(t_fileName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
               .addComponent(browseButton, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGap(18, 18, 18)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(jLabel3)
               .addComponent(t_textSearch, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGap(18, 18, 18)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(jLabel4)
               .addComponent(cb_searchOptions, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGap(25, 25, 25)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(processButton)
               .addComponent(exitbutton))
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
      );

      jLabel1.setFont(new java.awt.Font("Dialog", 1, 18));
      jLabel1.setForeground(new java.awt.Color(0, 51, 153));
      jLabel1.setText("TEXT SEARCH");

      javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
      getContentPane().setLayout(layout);
      layout.setHorizontalGroup(
         layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
            .addContainerGap(29, Short.MAX_VALUE)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGap(71, 71, 71))
         .addGroup(layout.createSequentialGroup()
            .addGap(204, 204, 204)
            .addComponent(jLabel1)
            .addContainerGap(247, Short.MAX_VALUE))
      );
      layout.setVerticalGroup(
         layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(layout.createSequentialGroup()
            .addGap(43, 43, 43)
            .addComponent(jLabel1)
            .addGap(18, 18, 18)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap(42, Short.MAX_VALUE))
      );

      pack();
   }// </editor-fold>//GEN-END:initComponents

   private void t_fileNameActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_t_fileNameActionPerformed
   // TODO add your handling code here:
}//GEN-LAST:event_t_fileNameActionPerformed

   private void browseButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_browseButtonActionPerformed
      chooseFile = new JFileChooser();
      chooseFile.setCurrentDirectory(new File(currentDir));
      int returnVal = chooseFile.showOpenDialog(jPanel1);

      if (returnVal == JFileChooser.APPROVE_OPTION) {
         File file = chooseFile.getSelectedFile();
         t_fileName.setText(file.getPath());
      }
      else {
      // JOptionPane.showMessageDialog(this,"No files selected!");
      }
      
}//GEN-LAST:event_browseButtonActionPerformed

   private void processButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_processButtonActionPerformed
      try {
         if (t_fileName.getText().trim().length() == 0) {
            t_fileName.requestFocus();
            JOptionPane.showMessageDialog(this, "Please specify a valid file name");
         }
         else if (t_textSearch.getText().trim().length() == 0) {
            t_textSearch.requestFocus();
            JOptionPane.showMessageDialog(this, "Please enter the text to be searched");
         }
         else {

            fileName = t_fileName.getText();
            word = t_textSearch.getText();
            fileContent = new StringBuffer();

            BufferedReader in = new BufferedReader(new FileReader(fileName));


            if (cb_searchOptions.getSelectedIndex() == 0) {

               while ((line = in.readLine()) != null) {
                  fileContent.append(line);
               }
               //if case-insensitive
               //int occurs = fileContent.toString().toUpperCase().split(word.toUpperCase()).length - 1;         
               int occurs = fileContent.toString().split(word).length - 1;

               if (occurs <= 0) {
                  JOptionPane.showMessageDialog(this, "Text not found in the file");
               }
               else {
                  setVisible(false);
                  TSearchReportFrame report = new TSearchReportFrame(this, word, "" + occurs);
                  report.setLocationRelativeTo(null);
                  report.setVisible(true);
               }
               in.close();
            }
            else {
               setVisible(false);
               TextSearchWindow textSearchWin = new TextSearchWindow(this, fileName, word);
               textSearchWin.setLocationRelativeTo(null);
               textSearchWin.setVisible(true);
            }

         }

      } catch (Exception e) {
         e.printStackTrace();
         JOptionPane.showMessageDialog(this, "Cannot read the specified file.\nPlease verify the file path.");
         t_fileName.requestFocus();
         t_fileName.selectAll();
      }    
     
}//GEN-LAST:event_processButtonActionPerformed

   private void t_textSearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_t_textSearchActionPerformed
   // TODO add your handling code here:
}//GEN-LAST:event_t_textSearchActionPerformed

   private void exitbuttonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_exitbuttonActionPerformed
      //System.exit(0);
      setVisible(false);
      parent.setVisible(true);
}//GEN-LAST:event_exitbuttonActionPerformed

   // Variables declaration - do not modify//GEN-BEGIN:variables
   private javax.swing.JButton browseButton;
   private javax.swing.JComboBox cb_searchOptions;
   private javax.swing.JButton exitbutton;
   private javax.swing.JLabel jLabel1;
   private javax.swing.JLabel jLabel2;
   private javax.swing.JLabel jLabel3;
   private javax.swing.JLabel jLabel4;
   private javax.swing.JPanel jPanel1;
   private javax.swing.JButton processButton;
   private javax.swing.JTextField t_fileName;
   private javax.swing.JTextField t_textSearch;
   // End of variables declaration//GEN-END:variables

   private JFileChooser chooseFile;
}
